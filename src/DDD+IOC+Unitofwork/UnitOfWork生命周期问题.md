在领域驱动设计（DDD）中，会遇到跨多个领域对象的事务问题，一般会采用使用UnitOfWork模式（工作单元）。在一个用例执行过程中，如何保证同一个界限上下文内的所有仓储实例可以共享同一个工作单元实例？

UnitOfWork是一种**有状态的**、**用例级别**的对象。如果不采用ORM是不会使用UnitOfWork模式的。Repository是一种特殊的领域服务，因此是**无状态的**、**全局单例**的。在一个用例中，一个UnitOfWork为多个Repository提供服务，也就是说Repository依赖UnitOfWork，但是**无状态对象不能依赖有状态的对象**，因此我们需要引入另外一个类型：**UnitOfWorkFactory**，该工厂是一种特殊的服务（无状态、全局单例），它保证创建会话级别的UnitOfWork。

如果UnitOfWork采用单例模式，则会导致数据库上下文对象和数据库连接一直不释放，当客户端达到一定数量，数据库连接池资源被耗尽，最终导致数据库服务不可用。

比较好的做法是一次请求内的所有仓储实例可以共享同一个工作单元实例，请求结束释放工作单元实例，数据库上下文对象和数据库连接随之释放。可以利用IOC容器帮助我们实现这一点，此处的IOC就可以理解为上文中的UnitOfWorkFactory。



